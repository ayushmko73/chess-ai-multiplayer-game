import React, { useState, useEffect, useCallback, useMemo } from 'react'; import { Chessboard } from 'react-chessboard'; import { Chess } from 'chess.js'; import { getBestMove } from './lib/engine.ts'; import { Settings, User, Cpu, RotateCcw, Trophy, Info } from 'lucide-react'; import { clsx, type ClassValue } from 'clsx'; import { twMerge } from 'tailwind-merge'; function cn(...inputs: ClassValue[]) { return twMerge(clsx(inputs)); } type GameMode = 'PvP' | 'PvE'; type Difficulty = 'Beginner' | 'Easy' | 'Hard' | 'Master'; export default function App() { [null]; const [game, setGame] = useState(new Chess()); const [mode, setMode] = useState<GameMode>('PvE'); const [difficulty, setDifficulty] = useState<Difficulty>('Easy'); const [moveHistory, setMoveHistory] = useState<string[]>([]); const [gameOver, setGameOver] = useState<{ winner: string | null; reason: string } | null>(null); const [isThinking, setIsThinking] = useState(false); const makeAMove = useCallback((move: any) => { try { const result = game.move(move); if (result) { setGame(new Chess(game.fen())); setMoveHistory(prev => [...prev, result.san]); return result; } } catch (e) { return null; } return null; }, [game]); useEffect(() => { if (mode === 'PvE' && game.turn() === 'b' && !game.isGameOver()) { setIsThinking(true); const timer = setTimeout(() => { const bestMove = getBestMove(game, difficulty); makeAMove(bestMove); setIsThinking(false); }, 600); return () => clearTimeout(timer); } }, [game, mode, difficulty, makeAMove]); useEffect(() => { if (game.isGameOver()) { let reason = 'Draw'; if (game.isCheckmate()) reason = 'Checkmate'; else if (game.isDraw()) reason = 'Draw'; else if (game.isStalemate()) reason = 'Stalemate'; setGameOver({ winner: game.turn() === 'w' ? 'Black' : 'White', reason }); } }, [game]); function onDrop(sourceSquare: string, targetSquare: string) { if (gameOver) return false; const move = makeAMove({ from: sourceSquare, to: targetSquare, promotion: 'q' }); if (move === null) return false; return true; } const resetGame = () => { setGame(new Chess()); setMoveHistory([]); setGameOver(null); setIsThinking(false); }; return ( <div className="min-h-screen bg-zinc-950 text-zinc-100 p-4 md:p-8 flex flex-col items-center justify-center font-sans"> <div className="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-12 gap-8"> <div className="lg:col-span-7 flex flex-col items-center gap-6"> <div className="w-full flex justify-between items-center bg-zinc-900/50 p-4 rounded-xl border border-zinc-800"> <div className="flex items-center gap-3"> <div className="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center"> <Cpu className="w-5 h-5 text-blue-400" /> </div> <div> <p className="text-sm font-medium">Opponent</p> <p className="text-xs text-zinc-400">{mode === 'PvE' ? `AI (${difficulty})` : 'Player 2'}</p> </div> </div> {isThinking && <div className="flex items-center gap-2 animate-pulse"> <div className="w-2 h-2 bg-blue-500 rounded-full"></div> <span className="text-xs text-blue-400 font-mono uppercase tracking-widest">Thinking...</span> </div>} </div> <div className="w-full aspect-square max-w-[560px] shadow-2xl shadow-blue-500/10 rounded-lg overflow-hidden border-4 border-zinc-800"> <Chessboard position={game.fen()} onPieceDrop={onDrop} boardOrientation="white" customDarkSquareStyle={{ backgroundColor: '#27272a' }} customLightSquareStyle={{ backgroundColor: '#3f3f46' }} animationDuration={300} /> </div> <div className="w-full flex justify-between items-center bg-zinc-900/50 p-4 rounded-xl border border-zinc-800"> <div className="flex items-center gap-3"> <div className="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center border border-zinc-700"> <User className="w-5 h-5 text-emerald-400" /> </div> <div> <p className="text-sm font-medium">You</p> <p className="text-xs text-zinc-400 font-mono uppercase">Playing as White</p> </div> </div> </div> </div> <div className="lg:col-span-5 flex flex-col gap-6"> <div className="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 flex flex-col gap-6"> <div className="flex items-center gap-2 border-b border-zinc-800 pb-4"> <Settings className="w-5 h-5 text-zinc-400" /> <h2 className="text-lg font-semibold">Game Controls</h2> </div> <div className="space-y-4"> <div> <label className="text-xs font-semibold text-zinc-500 uppercase mb-2 block">Game Mode</label> <div className="grid grid-cols-2 gap-2"> {(['PvP', 'PvE'] as GameMode[]).map((m) => ( <button key={m} onClick={() => { setMode(m); resetGame(); }} className={cn( "px-4 py-2 rounded-lg text-sm font-medium transition-all", mode === m ? "bg-white text-zinc-950 shadow-lg" : "bg-zinc-800 text-zinc-400 hover:bg-zinc-700" )} > {m === 'PvP' ? 'Local 2P' : 'VS Engine'} </button> ))} </div> </div> {mode === 'PvE' && ( <div> <label className="text-xs font-semibold text-zinc-500 uppercase mb-2 block">AI Difficulty</label> <div className="grid grid-cols-2 gap-2"> {(['Beginner', 'Easy', 'Hard', 'Master'] as Difficulty[]).map((d) => ( <button key={d} onClick={() => { setDifficulty(d); resetGame(); }} className={cn( "px-3 py-2 rounded-lg text-xs font-medium border transition-all", difficulty === d ? "bg-blue-600/10 border-blue-500/50 text-blue-400 shadow-[0_0_15px_rgba(59,130,246,0.15)]" : "bg-zinc-800 border-transparent text-zinc-400 hover:border-zinc-700" )} > {d} </button> ))} </div> </div> )} <button onClick={resetGame} className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-zinc-100 text-zinc-950 rounded-xl font-bold hover:bg-white active:scale-95 transition-all" > <RotateCcw className="w-4 h-4" /> Reset Match </button> </div> </div> <div className="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 flex-1 flex flex-col min-h-[300px]"> <div className="flex items-center justify-between border-b border-zinc-800 pb-4 mb-4"> <h3 className="text-sm font-semibold flex items-center gap-2"> <Info className="w-4 h-4 text-zinc-500" /> Move History </h3> <span className="text-[10px] bg-zinc-800 px-2 py-1 rounded text-zinc-400">{Math.ceil(moveHistory.length / 2)} Rounds</span> </div> <div className="grid grid-cols-2 gap-2 overflow-y-auto max-h-[300px] pr-2"> {moveHistory.map((move, idx) => ( <div key={idx} className={cn( "text-sm p-2 rounded flex justify-between", idx % 2 === 0 ? "bg-zinc-800/30" : "bg-transparent" )} > <span className="text-zinc-500 tabular-nums">{idx + 1}.</span> <span className="font-mono font-bold">{move}</span> </div> ))} {moveHistory.length === 0 && ( <div className="col-span-2 text-center py-12 text-zinc-600 italic text-sm"> No moves yet. Start the game! </div> )} </div> </div> </div> </div> {gameOver && ( <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"> <div className="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl scale-in-center"> <div className="w-20 h-20 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-6"> <Trophy className="w-10 h-10 text-blue-400" /> </div> <h2 className="text-2xl font-bold mb-2">Game Over</h2> <p className="text-zinc-400 mb-6"> {gameOver.reason === 'Draw' ? "It's a draw!" : `${gameOver.winner} wins by ${gameOver.reason}!`} </p> <button onClick={resetGame} className="w-full py-3 bg-white text-zinc-950 rounded-xl font-bold hover:bg-zinc-100 transition-colors" > Play Again </button> </div> </div> )} </div> ); }